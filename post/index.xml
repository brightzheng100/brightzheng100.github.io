<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on The future is Bright</title><link>https://brightzheng100.github.io/post/</link><description>Recent content in Posts on The future is Bright</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Copyright Â© 2021 Bright Zheg. All Rights Reserved.</copyright><lastBuildDate>Sat, 05 Jun 2021 11:55:46 +0800</lastBuildDate><atom:link href="https://brightzheng100.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>Diving Deeper Into Operator Framwork, Part 1</title><link>https://brightzheng100.github.io/post/2021/06/diving-deeper-into-operator-framwork-part-1/</link><pubDate>Sat, 05 Jun 2021 11:55:46 +0800</pubDate><guid>https://brightzheng100.github.io/post/2021/06/diving-deeper-into-operator-framwork-part-1/</guid><description>
&lt;style type="text/css">
.twitter-tweet {
font: 14px/1.45 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;
border-left: 4px solid #2b7bb9;
padding-left: 1.5em;
color: #555;
}
.twitter-tweet a {
color: #2b7bb9;
text-decoration: none;
}
blockquote.twitter-tweet a:hover,
blockquote.twitter-tweet a:focus {
text-decoration: underline;
}
&lt;/style>
&lt;blockquote class="twitter-tweet">&lt;p lang="en" dir="ltr">Kubernetes is a platform for building platforms. It&amp;#39;s a better place to start; not the endgame.&lt;/p>&amp;mdash; Kelsey Hightower (@kelseyhightower) &lt;a href="https://twitter.com/kelseyhightower/status/935252923721793536?ref_src=twsrc%5Etfw">November 27, 2017&lt;/a>&lt;/blockquote>
&lt;p>When managing and operating complex software on Kubernetes, it's very common to think about the operator pattern which can simplify a lot of things for day 1 and day 2, from the SRE/Operator perspective, with the cost of coding.&lt;/p>
&lt;p>Believe it or not, there are a lot of boilerplate code that we need to spend time with, if you'd build Kubernetes operators from scratch.&lt;/p>
&lt;p>Fortunately, there are a few great operator frameworks in the OSS Kubernetes community that can really help us out.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes-sigs/kubebuilder">&lt;code>kubebuilder&lt;/code>&lt;/a>, curated by one of the Kubernetes SIGs with a focus on building operators in Golang;&lt;/li>
&lt;li>&lt;a href="https://sdk.operatorframework.io/">&lt;code>Operator SDK&lt;/code>&lt;/a>, led by Red Hat, bringing in more &amp;quot;enterprise&amp;quot; taste with broader language support (e.g. Golang, Helm, Ansible) and &lt;a href="https://olm.operatorframework.io/">&lt;code>Operator Lifecycle Manager (OLM)&lt;/code>&lt;/a>.&lt;/li>
&lt;/ul>
&lt;p>Before you start struggling with &amp;quot;oh, which one should I go with&amp;quot;, let me share a little bit about what I understand:&lt;/p>
&lt;ol>
&lt;li>Both are built on top of &lt;a href="https://github.com/kubernetes-sigs/controller-runtime">&lt;code>controller-runtime&lt;/code>&lt;/a> library;&lt;/li>
&lt;li>Both are tools for scaffolding and code generation to bootstrap a new operator project fast and the folder structures scaffolded are highly similar;&lt;/li>
&lt;li>Both contributors are active in Kubernetes' Slack channel #kubernetes-operators and are contributing heavily to upstream &lt;code>controller-runtime&lt;/code>;&lt;/li>
&lt;li>Maybe more in common that I'm not aware of.&lt;/li>
&lt;/ol>
&lt;p>In short, they have many in common.&lt;/p>
&lt;p>So if you simply just want to try building an operator for learning, pick any of them and you're good to rock.&lt;/p>
&lt;p>In this blog series, I'll dive deeper into &lt;code>Operator SDK&lt;/code> and hopefully you can figure out the differences along the way.&lt;/p>
&lt;p>There are two part of this blog series:&lt;/p>
&lt;ul>
&lt;li>Part 1: which is this blog, let me walk you through a typical Kubernetes operator building process;&lt;/li>
&lt;li>Part 2: I'll dive deeper into &lt;a href="https://olm.operatorframework.io/">&lt;code>Operator Lifecycle Manager (OLM)&lt;/code>&lt;/a>, &lt;a href="https://brightzheng100.github.io/post/2021/06/diving-deeper-into-operator-framwork-part-2/">here&lt;/a>.&lt;/li>
&lt;/ul>
&lt;h2 id="quick-start">Quick Start&lt;/h2>
&lt;p>The best place to start with &lt;code>Operator SDK&lt;/code> should be here: &lt;a href="https://sdk.operatorframework.io/docs/">https://sdk.operatorframework.io/docs/&lt;/a>.&lt;/p>
&lt;p>And we'll focus on building the operator by Golang, in a Mac. So your mileage may slightly vary but I guarantee that you'd still easily get the idea.&lt;/p>
&lt;h3 id="preparation">Preparation&lt;/h3>
&lt;p>We need a Kubernetes cluster, after all, we're developing Kubernetes stuff.&lt;/p>
&lt;p>The simplest way I can think of is to spin up a &lt;a href="https://kind.sigs.k8s.io/">&lt;code>kind&lt;/code>&lt;/a> cluster.&lt;/p>
&lt;blockquote>
&lt;p>Prerequisites: Docker Desktop is up and running.&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Install kind CLI if you haven&amp;#39;t&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ brew install kind
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span>&lt;span class="c1"># Prepare a simple config file&lt;/span>
&lt;span class="ln"> 5&lt;/span>$ cat &amp;gt; kind-cluster.yaml &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;span class="ln"> 6&lt;/span>&lt;span class="s">kind: Cluster
&lt;/span>&lt;span class="ln"> 7&lt;/span>&lt;span class="s">apiVersion: kind.x-k8s.io/v1alpha4
&lt;/span>&lt;span class="ln"> 8&lt;/span>&lt;span class="s">nodes:
&lt;/span>&lt;span class="ln"> 9&lt;/span>&lt;span class="s">- role: control-plane
&lt;/span>&lt;span class="ln">10&lt;/span>&lt;span class="s">- role: worker
&lt;/span>&lt;span class="ln">11&lt;/span>&lt;span class="s">EOF&lt;/span>
&lt;span class="ln">12&lt;/span>
&lt;span class="ln">13&lt;/span>&lt;span class="c1"># And then create the cluster&lt;/span>
&lt;span class="ln">14&lt;/span>$ kind create cluster --config kind-cluster.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Once the cluster is created, the current context will be automatically changed to the newly provisioned &lt;code>kind&lt;/code> cluster.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Let&amp;#39;s check the nodes&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ kubectl get nodes
&lt;span class="ln"> 3&lt;/span>NAME STATUS ROLES AGE VERSION
&lt;span class="ln"> 4&lt;/span>kind-control-plane Ready control-plane,master 3h47m v1.21.1
&lt;span class="ln"> 5&lt;/span>kind-worker Ready &amp;lt;none&amp;gt; 3h47m v1.21.1
&lt;span class="ln"> 6&lt;/span>
&lt;span class="ln"> 7&lt;/span>&lt;span class="c1"># And the pods in kube-system&lt;/span>
&lt;span class="ln"> 8&lt;/span>$ kubectl get pods -n kube-system
&lt;span class="ln"> 9&lt;/span>NAME READY STATUS RESTARTS AGE
&lt;span class="ln">10&lt;/span>coredns-558bd4d5db-jk8h8 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">11&lt;/span>coredns-558bd4d5db-klnjx 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">12&lt;/span>etcd-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">13&lt;/span>kindnet-7sx5m 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">14&lt;/span>kindnet-f9pj7 1/1 Running &lt;span class="m">0&lt;/span> 3h46m
&lt;span class="ln">15&lt;/span>kube-apiserver-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">16&lt;/span>kube-controller-manager-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">17&lt;/span>kube-proxy-d2w44 1/1 Running &lt;span class="m">0&lt;/span> 3h46m
&lt;span class="ln">18&lt;/span>kube-proxy-lvxhm 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">19&lt;/span>kube-scheduler-kind-control-plane 1/1 Running &lt;span class="m">0&lt;/span> 3h47m
&lt;span class="ln">20&lt;/span>
&lt;span class="ln">21&lt;/span>&lt;span class="c1"># Yes, the &amp;#34;nodes&amp;#34; are actually Docker container -- that&amp;#39;s why it&amp;#39;s called &amp;#34;kind&amp;#34;, Kubernetes in Docker&lt;/span>
&lt;span class="ln">22&lt;/span>$ docker ps
&lt;span class="ln">23&lt;/span>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;span class="ln">24&lt;/span>c18e7a78bec6 kindest/node:v1.21.1 &lt;span class="s2">&amp;#34;/usr/local/bin/entrâ€¦&amp;#34;&lt;/span> &lt;span class="m">4&lt;/span> hours ago Up &lt;span class="m">4&lt;/span> hours 127.0.0.1:50057-&amp;gt;6443/tcp kind-control-plane
&lt;span class="ln">25&lt;/span>b4f4856f7181 kindest/node:v1.21.1 &lt;span class="s2">&amp;#34;/usr/local/bin/entrâ€¦&amp;#34;&lt;/span> &lt;span class="m">4&lt;/span> hours ago Up &lt;span class="m">4&lt;/span> hours kind-worker
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="installing-operator-sdk">Installing &lt;code>operator-sdk&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>&lt;span class="c1"># Install operator-sdk by brew, if you haven&amp;#39;t&lt;/span>
&lt;span class="ln">2&lt;/span>$ brew install operator-sdk
&lt;span class="ln">3&lt;/span>
&lt;span class="ln">4&lt;/span>&lt;span class="c1"># Check the installed version&lt;/span>
&lt;span class="ln">5&lt;/span>$ operator-sdk version
&lt;span class="ln">6&lt;/span>operator-sdk version: &lt;span class="s2">&amp;#34;v1.7.2&amp;#34;&lt;/span>, commit: &lt;span class="s2">&amp;#34;6db9787d4e9ff63f344e23bfa387133112bda56b&amp;#34;&lt;/span>, kubernetes version: &lt;span class="s2">&amp;#34;1.19.4&amp;#34;&lt;/span>, go version: &lt;span class="s2">&amp;#34;go1.15.5&amp;#34;&lt;/span>, GOOS: &lt;span class="s2">&amp;#34;darwin&amp;#34;&lt;/span>, GOARCH: &lt;span class="s2">&amp;#34;amd64&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="initializing-an-operator">Initializing an operator&lt;/h3>
&lt;p>Let's initialize an operator, say namely &amp;quot;memcached-operator&amp;quot;.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>$ mkdir memcached-operator &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> memcached-operator
&lt;span class="ln"> 2&lt;/span>$ operator-sdk init --domain example.com --repo github.com/example/memcached-operator
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span>&lt;span class="c1"># See what we got&lt;/span>
&lt;span class="ln"> 5&lt;/span>$ tree
&lt;span class="ln"> 6&lt;/span>.
&lt;span class="ln"> 7&lt;/span>â”œâ”€â”€ Dockerfile
&lt;span class="ln"> 8&lt;/span>â”œâ”€â”€ Makefile
&lt;span class="ln"> 9&lt;/span>â”œâ”€â”€ PROJECT
&lt;span class="ln">10&lt;/span>â”œâ”€â”€ config
&lt;span class="ln">11&lt;/span>â”‚Â Â  â”œâ”€â”€ default
&lt;span class="ln">12&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">13&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_auth_proxy_patch.yaml
&lt;span class="ln">14&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager_config_patch.yaml
&lt;span class="ln">15&lt;/span>â”‚Â Â  â”œâ”€â”€ manager
&lt;span class="ln">16&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller_manager_config.yaml
&lt;span class="ln">17&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">18&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager.yaml
&lt;span class="ln">19&lt;/span>â”‚Â Â  â”œâ”€â”€ manifests
&lt;span class="ln">20&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ kustomization.yaml
&lt;span class="ln">21&lt;/span>â”‚Â Â  â”œâ”€â”€ prometheus
&lt;span class="ln">22&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">23&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ monitor.yaml
&lt;span class="ln">24&lt;/span>â”‚Â Â  â”œâ”€â”€ rbac
&lt;span class="ln">25&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_client_clusterrole.yaml
&lt;span class="ln">26&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role.yaml
&lt;span class="ln">27&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role_binding.yaml
&lt;span class="ln">28&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_service.yaml
&lt;span class="ln">29&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">30&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role.yaml
&lt;span class="ln">31&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role_binding.yaml
&lt;span class="ln">32&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ role_binding.yaml
&lt;span class="ln">33&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ service_account.yaml
&lt;span class="ln">34&lt;/span>â”‚Â Â  â””â”€â”€ scorecard
&lt;span class="ln">35&lt;/span>â”‚Â Â  â”œâ”€â”€ bases
&lt;span class="ln">36&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ config.yaml
&lt;span class="ln">37&lt;/span>â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">38&lt;/span>â”‚Â Â  â””â”€â”€ patches
&lt;span class="ln">39&lt;/span>â”‚Â Â  â”œâ”€â”€ basic.config.yaml
&lt;span class="ln">40&lt;/span>â”‚Â Â  â””â”€â”€ olm.config.yaml
&lt;span class="ln">41&lt;/span>â”œâ”€â”€ go.mod
&lt;span class="ln">42&lt;/span>â”œâ”€â”€ go.sum
&lt;span class="ln">43&lt;/span>â”œâ”€â”€ hack
&lt;span class="ln">44&lt;/span>â”‚Â Â  â””â”€â”€ boilerplate.go.txt
&lt;span class="ln">45&lt;/span>â””â”€â”€ main.go
&lt;span class="ln">46&lt;/span>
&lt;span class="ln">47&lt;/span>&lt;span class="m">10&lt;/span> directories, &lt;span class="m">29&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Note: as of writing, the &lt;code>operator-sdk&lt;/code> &lt;strong>v1.7.2&lt;/strong> is compatible with Golang version of &lt;code>1.13 &amp;lt;= version &amp;lt; 1.16&lt;/code>, so if you're with Golang version &lt;code>&amp;gt;=1.16&lt;/code>, try adding the &lt;code>--skip-go-version-check&lt;/code> flag in &lt;code>operator-sdk init&lt;/code> command.&lt;/p>
&lt;/blockquote>
&lt;h3 id="creating-apis">Creating APIs&lt;/h3>
&lt;p>We just initialized it with an empty structure. Let's create a simple API named &amp;quot;Memcached&amp;quot;:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Create an API named &amp;#34;Memcached&amp;#34;&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ operator-sdk create api --group cache --version v1alpha1 --kind Memcached --resource --controller
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span>&lt;span class="c1"># See what we got again&lt;/span>
&lt;span class="ln"> 5&lt;/span>$ tree
&lt;span class="ln"> 6&lt;/span>.
&lt;span class="ln"> 7&lt;/span>â”œâ”€â”€ Dockerfile
&lt;span class="ln"> 8&lt;/span>â”œâ”€â”€ Makefile
&lt;span class="ln"> 9&lt;/span>â”œâ”€â”€ PROJECT
&lt;span class="ln">10&lt;/span>â”œâ”€â”€ api
&lt;span class="ln">11&lt;/span>â”‚Â Â  â””â”€â”€ v1alpha1
&lt;span class="ln">12&lt;/span>â”‚Â Â  â”œâ”€â”€ groupversion_info.go
&lt;span class="ln">13&lt;/span>â”‚Â Â  â”œâ”€â”€ memcached_types.go
&lt;span class="ln">14&lt;/span>â”‚Â Â  â””â”€â”€ zz_generated.deepcopy.go
&lt;span class="ln">15&lt;/span>â”œâ”€â”€ bin
&lt;span class="ln">16&lt;/span>â”‚Â Â  â””â”€â”€ controller-gen
&lt;span class="ln">17&lt;/span>â”œâ”€â”€ config
&lt;span class="ln">18&lt;/span>â”‚Â Â  â”œâ”€â”€ crd
&lt;span class="ln">19&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">20&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomizeconfig.yaml
&lt;span class="ln">21&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ patches
&lt;span class="ln">22&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cainjection_in_memcacheds.yaml
&lt;span class="ln">23&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ webhook_in_memcacheds.yaml
&lt;span class="ln">24&lt;/span>â”‚Â Â  â”œâ”€â”€ default
&lt;span class="ln">25&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">26&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ manager_auth_proxy_patch.yaml
&lt;span class="ln">27&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager_config_patch.yaml
&lt;span class="ln">28&lt;/span>â”‚Â Â  â”œâ”€â”€ manager
&lt;span class="ln">29&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controller_manager_config.yaml
&lt;span class="ln">30&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">31&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ manager.yaml
&lt;span class="ln">32&lt;/span>â”‚Â Â  â”œâ”€â”€ manifests
&lt;span class="ln">33&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ kustomization.yaml
&lt;span class="ln">34&lt;/span>â”‚Â Â  â”œâ”€â”€ prometheus
&lt;span class="ln">35&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">36&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ monitor.yaml
&lt;span class="ln">37&lt;/span>â”‚Â Â  â”œâ”€â”€ rbac
&lt;span class="ln">38&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_client_clusterrole.yaml
&lt;span class="ln">39&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role.yaml
&lt;span class="ln">40&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_role_binding.yaml
&lt;span class="ln">41&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ auth_proxy_service.yaml
&lt;span class="ln">42&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">43&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role.yaml
&lt;span class="ln">44&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ leader_election_role_binding.yaml
&lt;span class="ln">45&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ memcached_editor_role.yaml
&lt;span class="ln">46&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ memcached_viewer_role.yaml
&lt;span class="ln">47&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ role_binding.yaml
&lt;span class="ln">48&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ service_account.yaml
&lt;span class="ln">49&lt;/span>â”‚Â Â  â”œâ”€â”€ samples
&lt;span class="ln">50&lt;/span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache_v1alpha1_memcached.yaml
&lt;span class="ln">51&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ kustomization.yaml
&lt;span class="ln">52&lt;/span>â”‚Â Â  â””â”€â”€ scorecard
&lt;span class="ln">53&lt;/span>â”‚Â Â  â”œâ”€â”€ bases
&lt;span class="ln">54&lt;/span>â”‚Â Â  â”‚Â Â  â””â”€â”€ config.yaml
&lt;span class="ln">55&lt;/span>â”‚Â Â  â”œâ”€â”€ kustomization.yaml
&lt;span class="ln">56&lt;/span>â”‚Â Â  â””â”€â”€ patches
&lt;span class="ln">57&lt;/span>â”‚Â Â  â”œâ”€â”€ basic.config.yaml
&lt;span class="ln">58&lt;/span>â”‚Â Â  â””â”€â”€ olm.config.yaml
&lt;span class="ln">59&lt;/span>â”œâ”€â”€ controllers
&lt;span class="ln">60&lt;/span>â”‚Â Â  â”œâ”€â”€ memcached_controller.go
&lt;span class="ln">61&lt;/span>â”‚Â Â  â””â”€â”€ suite_test.go
&lt;span class="ln">62&lt;/span>â”œâ”€â”€ go.mod
&lt;span class="ln">63&lt;/span>â”œâ”€â”€ go.sum
&lt;span class="ln">64&lt;/span>â”œâ”€â”€ hack
&lt;span class="ln">65&lt;/span>â”‚Â Â  â””â”€â”€ boilerplate.go.txt
&lt;span class="ln">66&lt;/span>â””â”€â”€ main.go
&lt;span class="ln">67&lt;/span>
&lt;span class="ln">68&lt;/span>&lt;span class="m">17&lt;/span> directories, &lt;span class="m">43&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;p>As you can see, more stuff have been generated for us -- that's exactly the value for such a tool to scaffold and generate boilerplate code for us to bootstrap a new operator project fast.&lt;/p>
&lt;h3 id="coding-the-operator">Coding the operator&lt;/h3>
&lt;p>Well, not really the focus for now.&lt;/p>
&lt;p>But in order to judge whether it really works, let's log something out at least:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>&lt;span class="c1"># Edit controllers/memcached_controller.go&lt;/span>
&lt;span class="ln">2&lt;/span>$ vi controllers/memcached_controller.go
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Change this:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="ln">1&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">MemcachedReconciler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Reconcile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span> &lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">2&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WithValues&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;memcached&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NamespacedName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="ln">3&lt;/span>
&lt;span class="ln">4&lt;/span> &lt;span class="c1">// your logic here
&lt;/span>&lt;span class="ln">5&lt;/span>&lt;span class="c1">&lt;/span>
&lt;span class="ln">6&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="ln">7&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>to:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="ln">1&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">r&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">MemcachedReconciler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Reconcile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span> &lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Request&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="ln">2&lt;/span> &lt;span class="nx">_&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">WithValues&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;memcached&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">req&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NamespacedName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="ln">3&lt;/span>
&lt;span class="ln">4&lt;/span> &lt;span class="c1">// your logic here
&lt;/span>&lt;span class="ln">5&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;great, the Reconcile is really triggered!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="ln">6&lt;/span>
&lt;span class="ln">7&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nx">ctrl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Result&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="ln">8&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You may refer to &lt;a href="https://sdk.operatorframework.io/docs/building-operators/golang/tutorial/#implement-the-controller">this doc&lt;/a> and &lt;a href="https://github.com/operator-framework/operator-sdk/blob/v1.3.0/testdata/go/v3/memcached-operator/controllers/memcached_controller.go">this file&lt;/a> for how to implement the Controller in a step-by-step basis, with a complete sample implementation.&lt;/p>
&lt;h3 id="optionally-creating-webhook">(Optionally) Creating webhook&lt;/h3>
&lt;p>In the Kubernetes world, there are 3 kinds of webhooks:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#admission-webhooks">admission webhook&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/webhook/">authorization webhook&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#webhook-conversion">CRD conversion webhook&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Currently, &lt;code>controller-runtime&lt;/code> supports &lt;code>admission webhooks&lt;/code> and &lt;code>CRD conversion webhooks&lt;/code>, so does the Operator SDK.&lt;/p>
&lt;p>The webhooks are optional but very powerful if they suit your needs. But let's ignore webhooks for now.&lt;/p>
&lt;h3 id="running-the-operator-locally">Running the operator locally&lt;/h3>
&lt;p>Even we've done nothing on coding the exact reconciliation logic, but guess what, the code generated is workable annd deployable.&lt;/p>
&lt;p>Since we now focus on the end-to-end process, we can proceed.&lt;/p>
&lt;p>Typically, we may want to run it outside of Kubernetes as a &amp;quot;normal&amp;quot; Golang project, to have a better development experience within the so-called &amp;quot;inner loop&amp;quot;:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>&lt;span class="c1"># Firstly, we have to install the CRDs&lt;/span>
&lt;span class="ln">2&lt;/span>$ make install
&lt;span class="ln">3&lt;/span>
&lt;span class="ln">4&lt;/span>&lt;span class="c1"># Then run it as a &amp;#34;normal&amp;#34; go project&lt;/span>
&lt;span class="ln">5&lt;/span>$ make run
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Note: if you check out the &lt;code>Makefile&lt;/code> you will realize that &lt;code>make run&lt;/code> is just to execute &lt;code>go run ./main.go&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>Now the operator is actually working, watching the &amp;quot;Memcached&amp;quot; CRs in the default cluster we're now connected to, which is the cluster powered by &lt;code>kind&lt;/code>.&lt;/p>
&lt;p>And we can open another console to create a CR to see what will happen:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Create a CR, which can refer to the example under config/samples/cache_v1alpha1_memcached.yaml&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ kubectl apply -f - &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;span class="ln"> 3&lt;/span>&lt;span class="s">apiVersion: cache.example.com/v1alpha1
&lt;/span>&lt;span class="ln"> 4&lt;/span>&lt;span class="s">kind: Memcached
&lt;/span>&lt;span class="ln"> 5&lt;/span>&lt;span class="s">metadata:
&lt;/span>&lt;span class="ln"> 6&lt;/span>&lt;span class="s"> name: memcached-sample
&lt;/span>&lt;span class="ln"> 7&lt;/span>&lt;span class="s">spec:
&lt;/span>&lt;span class="ln"> 8&lt;/span>&lt;span class="s"> # Add fields here
&lt;/span>&lt;span class="ln"> 9&lt;/span>&lt;span class="s"> foo: bar
&lt;/span>&lt;span class="ln">10&lt;/span>&lt;span class="s">EOF&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We should be able to see a log message like:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>2021-06-04T15:06:22.493Z INFO controllers.Memcached great, the Reconcile is really triggered!
&lt;/code>&lt;/pre>&lt;/div>&lt;p>As you can imagine, once you've implemented the reconciliation logic properly, this will work out for you.&lt;/p>
&lt;p>Now let's delete the CR:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>$ kubectl delete Memcached/memcached-sample
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We should be able to see the same log message again, indicating that the reconciliation logic can be triggered properly for you to handle the events.&lt;/p>
&lt;h3 id="building-and-running-the-operator">Building and running the operator&lt;/h3>
&lt;p>Let's pretend that we're happy with what we've developed, it's common to build and publish the operator as a container to a desired container repository like Docker Hub, or Quay.io, or something on prem. The choice is yours!&lt;/p>
&lt;p>Here I'm going to push to my Docker Hub account, you may change it to yours.
In this case, it's recommended to update the default &lt;code>Makefile&lt;/code> with below changes:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="ln">1&lt;/span>&lt;span class="gd">-IMG ?= controller:latest
&lt;/span>&lt;span class="ln">2&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+IMG ?= $(IMAGE_TAG_BASE):v$(VERSION)
&lt;/span>&lt;span class="ln">3&lt;/span>&lt;span class="gi">&lt;/span>
&lt;span class="ln">4&lt;/span>&lt;span class="gd">-IMAGE_TAG_BASE ?= example.com/memcached-operator
&lt;/span>&lt;span class="ln">5&lt;/span>&lt;span class="gd">&lt;/span>&lt;span class="gi">+IMAGE_TAG_BASE ?= brightzheng100/memcached-operator
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>So that we can avoid setting the &lt;code>IMG&lt;/code> in the commands all the times.&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Docker build and push&lt;/span>
&lt;span class="ln"> 2&lt;/span>&lt;span class="c1"># Instead of: make docker-build docker-push IMG=&amp;#34;brightzheng100/memcached-operator:0.0.1&amp;#34;&lt;/span>
&lt;span class="ln"> 3&lt;/span>$ make docker-build docker-push
&lt;span class="ln"> 4&lt;/span>
&lt;span class="ln"> 5&lt;/span>&lt;span class="c1"># Then deploy it&lt;/span>
&lt;span class="ln"> 6&lt;/span>&lt;span class="c1"># Instead of: make deploy IMG=&amp;#34;brightzheng100/memcached-operator:0.0.1&amp;#34;&lt;/span>
&lt;span class="ln"> 7&lt;/span>$ make deploy
&lt;span class="ln"> 8&lt;/span>
&lt;span class="ln"> 9&lt;/span>&lt;span class="c1"># Check it out&lt;/span>
&lt;span class="ln">10&lt;/span>$ kubectl get pods -n memcached-operator-system
&lt;span class="ln">11&lt;/span>NAME READY STATUS RESTARTS AGE
&lt;span class="ln">12&lt;/span>memcached-operator-controller-manager-7c759576bb-fwzfl 2/2 Running &lt;span class="m">0&lt;/span> 49s
&lt;span class="ln">13&lt;/span>
&lt;span class="ln">14&lt;/span>&lt;span class="c1"># Tail the logs&lt;/span>
&lt;span class="ln">15&lt;/span>$ kubectl logs memcached-operator-controller-manager-7c759576bb-fwzfl --all-containers -f -n memcached-operator-system
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Similarlly, we can open a new console and create the CR to test it out:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Create a CR, which can refer to the example under /config/samples/cache_v1alpha1_memcached.yaml&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ kubectl apply -f - &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;span class="ln"> 3&lt;/span>&lt;span class="s">apiVersion: cache.example.com/v1alpha1
&lt;/span>&lt;span class="ln"> 4&lt;/span>&lt;span class="s">kind: Memcached
&lt;/span>&lt;span class="ln"> 5&lt;/span>&lt;span class="s">metadata:
&lt;/span>&lt;span class="ln"> 6&lt;/span>&lt;span class="s"> name: memcached-sample
&lt;/span>&lt;span class="ln"> 7&lt;/span>&lt;span class="s">spec:
&lt;/span>&lt;span class="ln"> 8&lt;/span>&lt;span class="s"> # Add fields here
&lt;/span>&lt;span class="ln"> 9&lt;/span>&lt;span class="s"> foo: bar
&lt;/span>&lt;span class="ln">10&lt;/span>&lt;span class="s">EOF&lt;/span>
&lt;span class="ln">11&lt;/span>
&lt;span class="ln">12&lt;/span>&lt;span class="c1"># Check it out&lt;/span>
&lt;span class="ln">13&lt;/span>$ kubectl get memcached
&lt;span class="ln">14&lt;/span>NAME AGE
&lt;span class="ln">15&lt;/span>memcached-sample 40s
&lt;span class="ln">16&lt;/span>
&lt;span class="ln">17&lt;/span>&lt;span class="c1"># Then delete it&lt;/span>
&lt;span class="ln">18&lt;/span>$ kubectl delete Memcached/memcached-sample
&lt;/code>&lt;/pre>&lt;/div>&lt;p>And yes, we should be able to see exactly the log message twice, indicating that the &lt;code>Reconcile&lt;/code> method has been properly triggered twice for the corresponding CR events.&lt;/p>
&lt;h3 id="clean-up">Clean Up&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>$ make undeploy
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>As you've seen, building Kubernetes operators can be significantly simplified because of the operator frameworks like &lt;code>Operator SDK&lt;/code>.&lt;/p>
&lt;p>The project, the APIs, the webhooks can be generated by one command each so we can focus on implementing the operator's business logic.&lt;/p>
&lt;p>Our software can be packaged and managed by our operators, which is super cool...but if we think of &amp;quot;who will monitor the monitors&amp;quot;: are there any further practices to package, distrubute, manage and operate our operators?&lt;/p>
&lt;p>That's exactly my coming blog is going to cover. Stay tuned!&lt;/p></description></item><item><title>Adding Comments Into Hugo Powered Website</title><link>https://brightzheng100.github.io/post/2021/05/adding-comments-into-hugo-powered-website/</link><pubDate>Sun, 23 May 2021 22:27:49 +0800</pubDate><guid>https://brightzheng100.github.io/post/2021/05/adding-comments-into-hugo-powered-website/</guid><description>
&lt;p>Having a comment system integrated with our blogging system is obviously interesting and fun, even for a low traffic blogging website like mine:)&lt;/p>
&lt;p>But when it comes with some constraints, like:&lt;/p>
&lt;ul>
&lt;li>The comment system must be open source, free;&lt;/li>
&lt;li>The comment system must be easily integrated with GitHub Pages website powered by Hugo.&lt;/li>
&lt;/ul>
&lt;p>This can be interesting and let's implement that with the recommended &lt;a href="https://utteranc.es/">utteranc&lt;/a>.&lt;/p>
&lt;h2 id="how-it-works">How it works&lt;/h2>
&lt;p>According to &lt;a href="https://utteranc.es/">utteranc&lt;/a>'s website:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>When Utterances loads, the GitHub issue search API is used to find the issue
&lt;span class="ln">2&lt;/span>associated with the page based on url, pathname or title.
&lt;span class="ln">3&lt;/span>If we cannot find an issue that matches the page, no problem,
&lt;span class="ln">4&lt;/span>utterances-bot will automatically create an issue the first time someone comments.
&lt;/code>&lt;/pre>&lt;/div>&lt;p>So &lt;code>utteranc&lt;/code> makes use of GitHub's issue system and turns issues into comments, which is super smart and cool.&lt;/p>
&lt;h2 id="coniguration">Coniguration&lt;/h2>
&lt;p>The &lt;a href="https://utteranc.es/">utteranc&lt;/a>'s website offers a simple form for us to fill up in order to generate the configuration.&lt;/p>
&lt;p>What we need is to prepare some simple info:&lt;/p>
&lt;ul>
&lt;li>The repo, say mine is: &lt;strong>brightzheng100/brightzheng100.github.io&lt;/strong>&lt;/li>
&lt;li>Blog Post &amp;lt;-&amp;gt; Issue Mapping, let's pick the default option: &lt;strong>Issue title contains page pathname&lt;/strong>&lt;/li>
&lt;li>(optional) Issue Label, why not simply just: &lt;strong>utterances comments ðŸ’¬&lt;/strong>&lt;/li>
&lt;li>Theme, let's pick the default option: &lt;strong>GitHub Light&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>Now it will automatically help us generate the scripts:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="ln">1&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">script&lt;/span> &lt;span class="nx">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;https://utteranc.es/client.js&amp;#34;&lt;/span>
&lt;span class="ln">2&lt;/span> &lt;span class="nx">repo&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;brightzheng100/brightzheng100.github.io&amp;#34;&lt;/span>
&lt;span class="ln">3&lt;/span> &lt;span class="nx">issue&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">term&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;pathname&amp;#34;&lt;/span>
&lt;span class="ln">4&lt;/span> &lt;span class="nx">label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utterances comments ðŸ’¬&amp;#34;&lt;/span>
&lt;span class="ln">5&lt;/span> &lt;span class="nx">theme&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;github-light&amp;#34;&lt;/span>
&lt;span class="ln">6&lt;/span> &lt;span class="nx">crossorigin&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;anonymous&amp;#34;&lt;/span>
&lt;span class="ln">7&lt;/span> &lt;span class="kr">async&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;span class="ln">8&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="err">/script&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="integrate-it-with-hugo-website">Integrate it with Hugo website&lt;/h2>
&lt;p>Create &lt;code>layouts/partials/comments.html&lt;/code> containing above scripts generated by &lt;code>utteranc&lt;/code>.&lt;/p>
&lt;p>For example:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>$ mkdir -p layouts/partials
&lt;span class="ln"> 2&lt;/span>$ cat &amp;gt; layouts/partials/comments.html &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;span class="ln"> 3&lt;/span>&lt;span class="s">&amp;lt;script src=&amp;#34;https://utteranc.es/client.js&amp;#34;
&lt;/span>&lt;span class="ln"> 4&lt;/span>&lt;span class="s"> repo=&amp;#34;brightzheng100/brightzheng100.github.io&amp;#34;
&lt;/span>&lt;span class="ln"> 5&lt;/span>&lt;span class="s"> issue-term=&amp;#34;pathname&amp;#34;
&lt;/span>&lt;span class="ln"> 6&lt;/span>&lt;span class="s"> label=&amp;#34;utterances comments ðŸ’¬&amp;#34;
&lt;/span>&lt;span class="ln"> 7&lt;/span>&lt;span class="s"> theme=&amp;#34;github-light&amp;#34;
&lt;/span>&lt;span class="ln"> 8&lt;/span>&lt;span class="s"> crossorigin=&amp;#34;anonymous&amp;#34;
&lt;/span>&lt;span class="ln"> 9&lt;/span>&lt;span class="s"> async&amp;gt;
&lt;/span>&lt;span class="ln">10&lt;/span>&lt;span class="s">&amp;lt;/script&amp;gt;
&lt;/span>&lt;span class="ln">11&lt;/span>&lt;span class="s">EOF&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="install-the-utterances-app">Install the utterances app&lt;/h2>
&lt;p>Make sure the utterances app is installed on the repo, otherwise users will not be able to post comments.&lt;/p>
&lt;p>Navigate to &lt;a href="https://github.com/apps/utterances">here&lt;/a>, click the &lt;strong>Install&lt;/strong> button and follow through the installation guide.&lt;/p>
&lt;p>Make sure you grant it only to your blog website, for example, mine is: brightzheng100/brightzheng100.github.io&lt;/p>
&lt;p>And you will see the blogging website like mine come with a comment system, powered by &lt;a href="https://utteranc.es/">utteranc&lt;/a>!&lt;/p>
&lt;p>Enjoy!&lt;/p>
&lt;h2 id="references">References&lt;/h2>
&lt;ul>
&lt;li>How to add comments in Clarity
&lt;a href="https://github.com/chipzoller/hugo-clarity#comments">https://github.com/chipzoller/hugo-clarity#comments&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Complete Website Setup Guide by GitHub and Hugo</title><link>https://brightzheng100.github.io/post/2021/05/complete-website-setup-guide-by-github-and-hugo/</link><pubDate>Wed, 19 May 2021 17:28:43 +0800</pubDate><guid>https://brightzheng100.github.io/post/2021/05/complete-website-setup-guide-by-github-and-hugo/</guid><description>
&lt;p>I've been blogging in many different places like &lt;a href="http://bright-zheng.blogspot.com/">blogspot&lt;/a>, &lt;a href="https://brightzheng100.medium.com/">Medium&lt;/a> and even Linkedin. I'm tired with bad editors and feel quite comfortable with simply markdown.&lt;/p>
&lt;p>While I realize that &lt;a href="https://gohugo.io/">&lt;code>Hugo&lt;/code>&lt;/a> can do a good job building website and the potential to host it purly on GitHub, that makes a lot of sense to me as I can draft and share posts, tutorials, tips like maintaining code in my repo.&lt;/p>
&lt;p>So let's get started.&lt;/p>
&lt;p>And, since the website is powered by &lt;a href="https://gohugo.io/">&lt;code>Hugo&lt;/code>&lt;/a> and is hosted on GitHub, let me start with a blog sharing what I did setting it up in details.&lt;/p>
&lt;blockquote>
&lt;p>Note: I did all these on my MacBook Pro. So your mileage may vary.&lt;/p>
&lt;/blockquote>
&lt;h2 id="step-1-install-hugo">Step 1: Install Hugo&lt;/h2>
&lt;p>Prerequisites:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Git&lt;/code> is installed&lt;/li>
&lt;li>&lt;code>brew&lt;/code> is installed&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span># Install hugo
&lt;span class="ln">2&lt;/span>$ brew install hugo
&lt;span class="ln">3&lt;/span>
&lt;span class="ln">4&lt;/span># Check
&lt;span class="ln">5&lt;/span>$ hugo version
&lt;span class="ln">6&lt;/span>hugo v0.83.1+extended darwin/amd64 BuildDate=unknown
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-2-create-a-new-site">Step 2: Create a New Site&lt;/h2>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>$ hugo new site brightzheng100
&lt;span class="ln"> 2&lt;/span>Congratulations! Your new Hugo site is created in /Users/brightzheng/development/blog/brightzheng100.
&lt;span class="ln"> 3&lt;/span>
&lt;span class="ln"> 4&lt;/span>Just a few more steps and you are ready to go:
&lt;span class="ln"> 5&lt;/span>
&lt;span class="ln"> 6&lt;/span>1. Download a theme into the same-named folder.
&lt;span class="ln"> 7&lt;/span> Choose a theme from https://themes.gohugo.io/ or
&lt;span class="ln"> 8&lt;/span> create your own with the &lt;span class="s2">&amp;#34;hugo new theme &amp;lt;THEMENAME&amp;gt;&amp;#34;&lt;/span> command.
&lt;span class="ln"> 9&lt;/span>2. Perhaps you want to add some content. You can add single files
&lt;span class="ln">10&lt;/span> with &lt;span class="s2">&amp;#34;hugo new &amp;lt;SECTIONNAME&amp;gt;/&amp;lt;FILENAME&amp;gt;.&amp;lt;FORMAT&amp;gt;&amp;#34;&lt;/span>.
&lt;span class="ln">11&lt;/span>3. Start the built-in live server via &lt;span class="s2">&amp;#34;hugo server&amp;#34;&lt;/span>.
&lt;span class="ln">12&lt;/span>
&lt;span class="ln">13&lt;/span>Visit https://gohugo.io/ &lt;span class="k">for&lt;/span> quickstart guide and full documentation.
&lt;span class="ln">14&lt;/span>
&lt;span class="ln">15&lt;/span>$ &lt;span class="nb">cd&lt;/span> brightzheng100
&lt;span class="ln">16&lt;/span>$ git init
&lt;span class="ln">17&lt;/span>Initialized empty Git repository in /Users/brightzheng/development/blog/brightzheng100/.git/
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-3-add-a-theme">Step 3: Add a Theme&lt;/h2>
&lt;p>Pick your prefered theme from here: &lt;a href="https://themes.gohugo.io/">https://themes.gohugo.io/&lt;/a>.
This is the one I picked: &lt;a href="https://themes.gohugo.io/hugo-clarity/">https://themes.gohugo.io/hugo-clarity/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>&lt;span class="c1"># Clone it as a sub module&lt;/span>
&lt;span class="ln"> 2&lt;/span>$ git submodule add https://github.com/chipzoller/hugo-clarity themes/clarity
&lt;span class="ln"> 3&lt;/span>Cloning into &lt;span class="s1">&amp;#39;/Users/brightzheng/development/blog/brightzheng100/themes/clarity&amp;#39;&lt;/span>...
&lt;span class="ln"> 4&lt;/span>remote: Enumerating objects: 3126, &lt;span class="k">done&lt;/span>.
&lt;span class="ln"> 5&lt;/span>remote: Counting objects: 100% &lt;span class="o">(&lt;/span>285/285&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;span class="ln"> 6&lt;/span>remote: Compressing objects: 100% &lt;span class="o">(&lt;/span>125/125&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;span class="ln"> 7&lt;/span>remote: Total &lt;span class="m">3126&lt;/span> &lt;span class="o">(&lt;/span>delta 150&lt;span class="o">)&lt;/span>, reused &lt;span class="m">249&lt;/span> &lt;span class="o">(&lt;/span>delta 136&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">2841&lt;/span>
&lt;span class="ln"> 8&lt;/span>Receiving objects: 100% &lt;span class="o">(&lt;/span>3126/3126&lt;span class="o">)&lt;/span>, 5.15 MiB &lt;span class="p">|&lt;/span> 8.37 MiB/s, &lt;span class="k">done&lt;/span>.
&lt;span class="ln"> 9&lt;/span>Resolving deltas: 100% &lt;span class="o">(&lt;/span>1809/1809&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;span class="ln">10&lt;/span>
&lt;span class="ln">11&lt;/span>&lt;span class="c1"># Copy or move over the sample site&lt;/span>
&lt;span class="ln">12&lt;/span>$ ls
&lt;span class="ln">13&lt;/span>archetypes config.toml content data layouts static themes
&lt;span class="ln">14&lt;/span>$ ls themes/clarity/exampleSite/
&lt;span class="ln">15&lt;/span>archetypes config content layouts LICENSE README.md resources stati
&lt;span class="ln">16&lt;/span>$ cp -a themes/clarity/exampleSite/* .
&lt;span class="ln">17&lt;/span>$ ls
&lt;span class="ln">18&lt;/span>archetypes config config.toml content data layouts LICENSE README.md resources static themes
&lt;span class="ln">19&lt;/span>
&lt;span class="ln">20&lt;/span>&lt;span class="c1"># Enable the theme&lt;/span>
&lt;span class="ln">21&lt;/span>$ &lt;span class="nb">echo&lt;/span> &lt;span class="nv">theme&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="se">\&amp;#34;&lt;/span>clarity&lt;span class="se">\&amp;#34;&lt;/span> &amp;gt;&amp;gt; config.toml
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-4-add-some-content">Step 4: Add Some Content&lt;/h2>
&lt;p>You can manually create content files (for example as content/&lt;CATEGORY>/&lt;FILE>.&lt;FORMAT>) and provide metadata in them, however you can use the new command to do a few things for you (like add title and date):&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>$ hugo new post/getting-started.md
&lt;span class="ln">2&lt;/span>/Users/brightzheng/development/blog/brightzheng100/content/post/getting-started.md created
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-5-start-the-hugo-server">Step 5: Start the Hugo server&lt;/h2>
&lt;p>Now, start the Hugo server with drafts enabled:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>$ hugo server -D
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-6-customize-the-theme">Step 6: Customize the Theme&lt;/h2>
&lt;p>Your new site already looks great, but you will want to tweak it a little before you release it to the public.&lt;/p>
&lt;p>Open up config.toml in a text editor:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>baseURL = &amp;#34;https://example.org/&amp;#34;
&lt;span class="ln">2&lt;/span>languageCode = &amp;#34;en-us&amp;#34;
&lt;span class="ln">3&lt;/span>title = &amp;#34;My New Hugo Site&amp;#34;
&lt;span class="ln">4&lt;/span>theme = &amp;#34;ananke&amp;#34;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="step-7-build-static-pages">Step 7: Build static pages&lt;/h2>
&lt;p>It is simple. Just call:&lt;/p>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>hugo -D
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Note: Output will be in ./public/ directory by default (-d/--destination flag to change it, or set publishdir in the config file).&lt;/p>
&lt;/blockquote>
&lt;h2 id="step-8-further-customization">Step 8: Further Customization&lt;/h2>
&lt;h3 id="language">Language&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>/config/languages.toml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>What I've done:&lt;/p>
&lt;ul>
&lt;li>Updated the supported languages with English only for now&lt;/li>
&lt;/ul>
&lt;h3 id="menu">Menu&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>/config/_default/menu.en.toml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>What I've done:&lt;/p>
&lt;ul>
&lt;li>Refined the menu items&lt;/li>
&lt;/ul>
&lt;h3 id="params">Params&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>/config/_default/params.toml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>What I've done:&lt;/p>
&lt;ul>
&lt;li>Changed the params by following the comments&lt;/li>
&lt;li>Major changes including &lt;code>introDescription&lt;/code>, &lt;code>mainSections&lt;/code>, &lt;code>logo&lt;/code>, &lt;code>footerLogo&lt;/code>, &lt;code>iconsDir&lt;/code> etc.&lt;/li>
&lt;/ul>
&lt;h3 id="archetypes">archetypes&lt;/h3>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln">1&lt;/span>/archetypes
&lt;/code>&lt;/pre>&lt;/div>&lt;p>What I've done:&lt;/p>
&lt;ul>
&lt;li>added &lt;code>diary.md&lt;/code>&lt;/li>
&lt;li>and updated all these &amp;quot;templates&amp;quot;&lt;/li>
&lt;/ul>
&lt;h3 id="favicon">Favicon&lt;/h3>
&lt;p>Built a favicon with 32x32 specs.
Created a new folder named &lt;code>icons&lt;/code> under &lt;code>/static&lt;/code> and put the favicon as &lt;code>favicon-32x32.png&lt;/code> under this folder.&lt;/p>
&lt;h2 id="step-9-host-it-on-github">Step 9: Host It on GitHub&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>Generate a new personal token in: &lt;a href="https://github.com/settings/tokens">https://github.com/settings/tokens&lt;/a>. And then make a copy of the token generated;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Create two repositories:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>&amp;lt;USERNAME&amp;gt;/&amp;lt;USERNAME&amp;gt;.github.io.private&lt;/code> to host Hugo project, as a &lt;strong>private project&lt;/strong>, like &lt;code>brightzheng100/brightzheng100.github.io.private&lt;/code> -- well, the naming here is not important;&lt;/li>
&lt;li>&lt;code>&amp;lt;USERNAME&amp;gt;/&amp;lt;USERNAME&amp;gt;.github.io.private&lt;/code> to host published website project, as a &lt;strong>public project&lt;/strong>, like &lt;code>brightzheng100/brightzheng100.github.io&lt;/code> -- the naming is important as per GitHub's convention;&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>
&lt;p>Create a &lt;code>Secret&lt;/code> named &lt;code>TOKEN&lt;/code> under &lt;code>&amp;lt;USERNAME&amp;gt;/&amp;lt;USERNAME&amp;gt;.github.io.private&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Add &lt;code>.github/workflows/gh-pages.yml&lt;/code> to enable GitHub Actions:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln"> 1&lt;/span>mkdir -p .github/workflows
&lt;span class="ln"> 2&lt;/span>
&lt;span class="ln"> 3&lt;/span>cat &amp;gt; .github/workflows/gh-pages.yml &lt;span class="s">&amp;lt;&amp;lt;&amp;#39;EOF&amp;#39;
&lt;/span>&lt;span class="ln"> 4&lt;/span>&lt;span class="s">name: Hugo Website Generator
&lt;/span>&lt;span class="ln"> 5&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="ln"> 6&lt;/span>&lt;span class="s">on:
&lt;/span>&lt;span class="ln"> 7&lt;/span>&lt;span class="s"> push:
&lt;/span>&lt;span class="ln"> 8&lt;/span>&lt;span class="s"> branches:
&lt;/span>&lt;span class="ln"> 9&lt;/span>&lt;span class="s"> - main # Note: I&amp;#39;m using main branch in my private repo
&lt;/span>&lt;span class="ln">10&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="ln">11&lt;/span>&lt;span class="s">jobs:
&lt;/span>&lt;span class="ln">12&lt;/span>&lt;span class="s"> deploy:
&lt;/span>&lt;span class="ln">13&lt;/span>&lt;span class="s"> runs-on: ubuntu-20.04
&lt;/span>&lt;span class="ln">14&lt;/span>&lt;span class="s"> steps:
&lt;/span>&lt;span class="ln">15&lt;/span>&lt;span class="s"> - uses: actions/checkout@v2
&lt;/span>&lt;span class="ln">16&lt;/span>&lt;span class="s"> with:
&lt;/span>&lt;span class="ln">17&lt;/span>&lt;span class="s"> submodules: true # Fetch Hugo themes (true OR recursive)
&lt;/span>&lt;span class="ln">18&lt;/span>&lt;span class="s"> fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod
&lt;/span>&lt;span class="ln">19&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="ln">20&lt;/span>&lt;span class="s"> - name: Setup Hugo
&lt;/span>&lt;span class="ln">21&lt;/span>&lt;span class="s"> uses: peaceiris/actions-hugo@v2
&lt;/span>&lt;span class="ln">22&lt;/span>&lt;span class="s"> with:
&lt;/span>&lt;span class="ln">23&lt;/span>&lt;span class="s"> hugo-version: &amp;#39;latest&amp;#39;
&lt;/span>&lt;span class="ln">24&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="ln">25&lt;/span>&lt;span class="s"> - name: Build
&lt;/span>&lt;span class="ln">26&lt;/span>&lt;span class="s"> run: hugo --minify
&lt;/span>&lt;span class="ln">27&lt;/span>&lt;span class="s">
&lt;/span>&lt;span class="ln">28&lt;/span>&lt;span class="s"> - name: Deploy
&lt;/span>&lt;span class="ln">29&lt;/span>&lt;span class="s"> uses: peaceiris/actions-gh-pages@v3
&lt;/span>&lt;span class="ln">30&lt;/span>&lt;span class="s"> if: github.ref == &amp;#39;refs/heads/main&amp;#39;
&lt;/span>&lt;span class="ln">31&lt;/span>&lt;span class="s"> with:
&lt;/span>&lt;span class="ln">32&lt;/span>&lt;span class="s"> personal_token: ${{ secrets.TOKEN }}
&lt;/span>&lt;span class="ln">33&lt;/span>&lt;span class="s"> external_repository: brightzheng100/brightzheng100.github.io
&lt;/span>&lt;span class="ln">34&lt;/span>&lt;span class="s"> publish_branch: master
&lt;/span>&lt;span class="ln">35&lt;/span>&lt;span class="s"> publish_dir: ./public
&lt;/span>&lt;span class="ln">36&lt;/span>&lt;span class="s">EOF&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>Commit and push our code to the private project:&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="ln">1&lt;/span>git add .
&lt;span class="ln">2&lt;/span>git commit -am &lt;span class="s2">&amp;#34;initial commit&amp;#34;&lt;/span>
&lt;span class="ln">3&lt;/span>git branch -M main
&lt;span class="ln">4&lt;/span>git remote add origin git@github.com:brightzheng100/brightzheng100.github.io.private.git
&lt;span class="ln">5&lt;/span>git push -u origin main
&lt;/code>&lt;/pre>&lt;/div>&lt;p>That's it!&lt;/p>
&lt;h2 id="references">References&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>Hugo Quick Start:
&lt;a href="https://gohugo.io/getting-started/quick-start/">https://gohugo.io/getting-started/quick-start/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Hugo Themes guide:
&lt;a href="https://themes.gohugo.io/hugo-clarity/">https://themes.gohugo.io/hugo-clarity/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Directory Structure:
&lt;a href="https://gohugo.io/getting-started/directory-structure/">https://gohugo.io/getting-started/directory-structure/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Host on GitHub
&lt;a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/">https://gohugo.io/hosting-and-deployment/hosting-on-github/&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item></channel></rss>